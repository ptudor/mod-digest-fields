# Minimal Apache configuration for testing mod_digest_fields
# Usage:
#   apachectl -f /path/to/httpd-test.conf -k start
#   curl -I http://localhost:8765/test.txt
#   apachectl -f /path/to/httpd-test.conf -k stop

ServerRoot "/opt/local"
Listen 8765

# Minimal modules needed
LoadModule mpm_prefork_module lib/apache2/modules/mod_mpm_prefork.so
LoadModule authz_core_module lib/apache2/modules/mod_authz_core.so
LoadModule mime_module lib/apache2/modules/mod_mime.so
LoadModule dir_module lib/apache2/modules/mod_dir.so
LoadModule log_config_module lib/apache2/modules/mod_log_config.so

# Load our module (adjust path as needed)
LoadModule digest_fields_module /Users/ptudor/Git/Unix/mod-digest-fields/mod_digest_fields.so

# Basic settings
PidFile /tmp/httpd-test.pid
ErrorLog /tmp/httpd-test-error.log
LogLevel debug

# Document root pointing to test directory
DocumentRoot "/Users/ptudor/Git/Unix/mod-digest-fields/test"

<Directory "/Users/ptudor/Git/Unix/mod-digest-fields/test">
    Options None
    AllowOverride None
    Require all granted

    # RFC 9530 mode - emits Content-Digest header
    # Content-Digest: sha-256=:base64hash:
    DigestFields On
</Directory>

# Test with SHA-512 preference
<Location "/sha512">
    DigestFields On
    DigestFieldsAlgorithm sha-512
    DigestFieldsAlgorithm sha-256
</Location>

# Test with Repr-Digest for compressed files (all default extensions)
<Location "/compressed">
    DigestFields On
    DigestFieldsRepr On
</Location>

# Test with Repr-Digest limited to specific compression formats
<Location "/compressed-limited">
    DigestFields On
    DigestFieldsCompression gz bz2 zst lzfse
    DigestFieldsRepr On
</Location>

# Test with filename matching (archives only)
<Location "/archives">
    DigestFields On
    DigestFieldsMatch "\.(tar\.gz|zip)$"
    DigestFieldsRepr On
</Location>

# Mirror server example - disable on-the-fly compression
# Files are pre-compressed; sidecar hashes match compressed bytes on disk
<Location "/mirror">
    DigestFields On
    SetEnv no-gzip 1
    SetEnv no-brotli 1
</Location>

# Hidden sidecar directory - keeps directory listings clean
# Sidecar for /hidden/foo.tar.gz is /hidden/.checksum/foo.tar.gz.sha256
<Location "/hidden">
    DigestFields On
    DigestFieldsDirectory .checksum
</Location>
